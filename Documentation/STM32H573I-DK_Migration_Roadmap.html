
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8">
        <title>STM32H573I-DK_Migration_Roadmap.md</title>
        <style>
            
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 40px;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }
        h1, h2, h3, h4, h5, h6 {
            color: #333;
            margin-top: 20px;
        }
        code {
            background-color: #f5f5f5;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        th {
            background-color: #f2f2f2;
        }
        blockquote {
            border-left: 4px solid #ddd;
            padding-left: 10px;
            color: #666;
        }
        .mermaid {
            text-align: center;
        }
    
        </style>
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function() {
                mermaid.initialize({ startOnLoad: true });
            });
        </script>
    </head>
    <body>
        <h1>CRUSTy-Core STM32H573I-DK Migration Development Guide</h1>
<h2>Overview</h2>
<p>This document serves as a comprehensive guide for migrating CRUSTy-Core to the STM32H573I-DK microcontroller and implementing encryption services from the embedded system. Rather than providing complete code implementations, this guide focuses on the development process, key considerations, and effective prompts for instructing the development of each feature.</p>
<h2>Current System Analysis</h2>
<p>CRUSTy-Core currently has:</p>
<ol>
<li>
<p><strong>Hybrid Architecture</strong>:</p>
</li>
<li>
<p>Rust for input handling and memory-safe operations</p>
</li>
<li>C++ for cryptographic core and file operations</li>
<li>
<p>Well-defined FFI boundary between languages</p>
</li>
<li>
<p><strong>Cryptographic Implementation</strong>:</p>
</li>
<li>
<p>AES-256-GCM encryption via Rust's <code>aes-gcm</code> crate</p>
</li>
<li>Argon2id for password hashing and key derivation</li>
<li>
<p>Clean C++ wrapper around Rust crypto functions</p>
</li>
<li>
<p><strong>Missing Components for Embedded Target</strong>:</p>
</li>
<li>STM32H573I-DK hardware abstraction layer</li>
<li>Communication protocol between PC and embedded device</li>
<li>Hardware acceleration integration</li>
<li>Embedded-specific build configuration</li>
</ol>
<h2>Migration Strategy</h2>
<p><div class="mermaid">
flowchart TD
    A[Current CRUSTy-Core] --> B[Phase 1: Embedded Build Setup]
    B --> C[Phase 2: Hardware Abstraction Layer]
    C --> D[Phase 3: Communication Protocol]
    D --> E[Phase 4: Hardware Acceleration]
    E --> F[Phase 5: PC-Side Integration]
    F --> G[Phase 6: Testing & Optimization]

    classDef phase fill:#f9f9f9,stroke:#333,stroke-width:2px;
    class A,B,C,D,E,F,G phase;
</div></p>
<h2>Phase 1: Embedded Build Setup</h2>
<h3>1.1 ARM Toolchain Configuration</h3>
<p><strong>Description:</strong>
We need to create a CMake toolchain file for the STM32H573I-DK target. This file will define the cross-compiler settings, CPU flags, and other configuration needed for building the embedded firmware.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">CMake</span><span class="w"> </span><span class="n">toolchain</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span><span class="w"> </span><span class="n">target</span><span class="o">.</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">should</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">Generic</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">processor</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">ARM</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Specify</span><span class="w"> </span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">-</span><span class="n">gcc</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">cross</span><span class="w"> </span><span class="n">compiler</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">CPU</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Cortex</span><span class="o">-</span><span class="n">M7</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">mcpu</span><span class="o">=</span><span class="n">cortex</span><span class="o">-</span><span class="n">m7</span><span class="w"> </span><span class="o">-</span><span class="n">mthumb</span><span class="w"> </span><span class="o">-</span><span class="n">mfloat</span><span class="o">-</span><span class="n">abi</span><span class="o">=</span><span class="n">hard</span><span class="w"> </span><span class="o">-</span><span class="n">mfpu</span><span class="o">=</span><span class="n">fpv5</span><span class="o">-</span><span class="n">d16</span><span class="p">)</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">compiler</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">development</span><span class="w"> </span><span class="p">(</span><span class="n">function</span><span class="w"> </span><span class="n">sections</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sections</span><span class="p">,</span><span class="w"> </span><span class="n">no</span><span class="w"> </span><span class="n">exceptions</span><span class="p">)</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">flags</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">target</span>
<span class="mf">6.</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">cross</span><span class="o">-</span><span class="n">compilation</span>

<span class="n">Please</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">cmake</span><span class="o">/</span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">.</span><span class="n">cmake</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">ARM</span><span class="w"> </span><span class="n">toolchain</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">simple</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">CMake</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">arm</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">eabi</span><span class="o">.</span><span class="n">cmake</span><span class="w"> </span><span class="n">toolchain</span><span class="w"> </span><span class="n">file</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">basic</span><span class="w"> </span><span class="s2">&quot;Hello World&quot;</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">would</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">toolchain</span><span class="w"> </span><span class="n">file</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">verify</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">compiles</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">errors</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">ELF</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">suitable</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ARM</span><span class="w"> </span><span class="n">Cortex</span><span class="o">-</span><span class="n">M7</span><span class="w"> </span><span class="n">target</span>
</code></pre></div>

<h3>1.2 Rust Configuration for Embedded Target</h3>
<p><strong>Description:</strong>
We need to update the Rust crypto library's configuration to support the ARM Cortex-M7 target. This involves modifying the Cargo.toml file to add appropriate features and dependencies for embedded development.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H573I</span><span class="o">-</span><span class="nx">DK</span><span class="err">&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">ARM</span><span class="w"> </span><span class="nx">Cortex</span><span class="o">-</span><span class="nx">M7</span><span class="w"> </span><span class="nx">processor</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">modify</span><span class="w"> </span><span class="nx">rust</span><span class="o">/</span><span class="nx">crypto</span><span class="o">/</span><span class="nx">Cargo</span><span class="p">.</span><span class="nx">toml</span><span class="w"> </span><span class="nx">to</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">feature</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">conditional</span><span class="w"> </span><span class="nx">compilation</span><span class="w"> </span><span class="p">(</span><span class="nx">std</span><span class="w"> </span><span class="nx">vs</span><span class="w"> </span><span class="nx">embedded</span><span class="p">)</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Configure</span><span class="w"> </span><span class="nx">dependencies</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">work</span><span class="w"> </span><span class="nx">without</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">standard</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">needed</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">embedded</span><span class="o">-</span><span class="nx">specific</span><span class="w"> </span><span class="nx">dependencies</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">cortex</span><span class="o">-</span><span class="nx">m</span><span class="p">,</span><span class="w"> </span><span class="nx">cortex</span><span class="o">-</span><span class="nx">m</span><span class="o">-</span><span class="nx">rt</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">stm32h5</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Ensure</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">crate</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">compiled</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">both</span><span class="w"> </span><span class="nx">PC</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">targets</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Keep</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">existing</span><span class="w"> </span><span class="nx">staticlib</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">rlib</span><span class="w"> </span><span class="nx">crate</span><span class="w"> </span><span class="nx">types</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">configuration</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="nx">works</span><span class="w"> </span><span class="nx">correctly</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">simple</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">checks</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">compiles</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">ARM</span><span class="w"> </span><span class="nx">target</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">command</span><span class="p">:</span><span class="w"> </span><span class="nx">cargo</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="o">--</span><span class="nx">target</span><span class="w"> </span><span class="nx">thumbv7em</span><span class="o">-</span><span class="nx">none</span><span class="o">-</span><span class="nx">eabihf</span><span class="w"> </span><span class="o">--</span><span class="nx">features</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="k">default</span><span class="o">-</span><span class="nx">features</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">compilation</span><span class="w"> </span><span class="nx">succeeds</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">produces</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">static</span><span class="w"> </span><span class="kn">library</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">depend</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">standard</span><span class="w"> </span><span class="kn">library</span>
</code></pre></div>

<h3>1.3 CMake Configuration for Embedded Target</h3>
<p><strong>Description:</strong>
We need to update the main CMakeLists.txt file to support building for the STM32H573I-DK target. This involves adding options for the embedded target, configuring the STM32CubeH5 HAL, and setting up the embedded firmware target.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">update</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">CMakeLists</span><span class="p">.</span><span class="nx">txt</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="nx">building</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H573I</span><span class="o">-</span><span class="nx">DK</span><span class="w"> </span><span class="nx">target</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">option</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">building</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="p">(</span><span class="nx">BUILD_EMBEDDED_TARGET</span><span class="p">)</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Configure</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32CubeH5</span><span class="w"> </span><span class="nx">HAL</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">building</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">embedded</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">appropriate</span><span class="w"> </span><span class="nx">definitions</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="nx">DEMBEDDED_TARGET</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">DSTM32H573xx</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="nx">DNO_QT_UI</span><span class="p">)</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Set</span><span class="w"> </span><span class="nx">up</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">flags</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">target</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">an</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">firmware</span><span class="w"> </span><span class="nx">target</span><span class="w"> </span><span class="p">(</span><span class="nx">crusty_embedded</span><span class="p">)</span>
<span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">post</span><span class="o">-</span><span class="nx">build</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">generate</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">binary</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">flashing</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code>I need to test if our CMake configuration for the embedded target works correctly. Please:
1. Configure the project with -DBUILD_EMBEDDED_TARGET=ON -DCMAKE_TOOLCHAIN_FILE=cmake/arm-none-eabi.cmake
2. Build the project and verify it compiles without errors
3. Check that the crusty_embedded target is created
4. Verify that the post-build command generates a binary file
5. Examine the binary file to ensure it&#39;s suitable for flashing to the STM32H573I-DK
</code></pre></div>

<h3>1.4 CMake Preset for Embedded Target</h3>
<p><strong>Description:</strong>
We need to add a new preset to CMakePresets.json for the STM32H573I-DK target. This will make it easier to configure the project for embedded development.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">new</span><span class="w"> </span><span class="n">preset</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">CMakePresets</span><span class="o">.</span><span class="n">json</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span><span class="w"> </span><span class="n">target</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">preset</span><span class="w"> </span><span class="n">named</span><span class="w"> </span><span class="s2">&quot;stm32h573i-dk&quot;</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">generator</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s2">&quot;Ninja&quot;</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Configure</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">ARM</span><span class="w"> </span><span class="n">toolchain</span><span class="w"> </span><span class="n">file</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Enable</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">BUILD_EMBEDDED_TARGET</span><span class="w"> </span><span class="n">option</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Disable</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">USE_QT</span><span class="w"> </span><span class="n">option</span>
<span class="mf">6.</span><span class="w"> </span><span class="n">Set</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">build</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="s2">&quot;Release&quot;</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">CMake</span><span class="w"> </span><span class="n">preset</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">command</span><span class="p">:</span><span class="w"> </span><span class="n">cmake</span><span class="w"> </span><span class="o">--</span><span class="n">preset</span><span class="w"> </span><span class="n">stm32h573i</span><span class="o">-</span><span class="n">dk</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">succeeds</span><span class="w"> </span><span class="n">without</span><span class="w"> </span><span class="n">errors</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Check</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="p">(</span><span class="n">BUILD_EMBEDDED_TARGET</span><span class="o">=</span><span class="n">ON</span><span class="p">,</span><span class="w"> </span><span class="n">USE_QT</span><span class="o">=</span><span class="n">OFF</span><span class="p">)</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">ARM</span><span class="w"> </span><span class="n">toolchain</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">being</span><span class="w"> </span><span class="n">used</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Build</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">project</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">preset</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">successful</span><span class="w"> </span><span class="n">compilation</span>
</code></pre></div>

<h2>Phase 2: Hardware Abstraction Layer</h2>
<h3>2.1 Embedded Main Entry Point</h3>
<p><strong>Description:</strong>
We need to create the main entry point for the embedded firmware. This will initialize the hardware, set up the communication protocol, and implement the main processing loop.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code>I need to create the main entry point for our STM32H573I-DK firmware. Please create src/cpp/embedded_main.cpp that:
1. Includes necessary headers for the STM32H5 HAL, our encryptor, and communication protocol
2. Initializes the hardware (HAL_Init, SystemClock_Config)
3. Sets up our hardware abstraction layer
4. Initializes the communication protocol
5. Creates an encryptor instance
6. Implements a main processing loop that:
   <span class="k">-</span> Checks for incoming commands
   <span class="k">-</span> Processes commands (encrypt, decrypt, key generation)
   <span class="k">-</span> Sends responses
   <span class="k">-</span> Optionally enters low-power mode when idle
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="nx">point</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">mock</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">abstraction</span><span class="w"> </span><span class="nx">layer</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">communication</span><span class="w"> </span><span class="nx">protocol</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Write</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">unit</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">verifies</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Hardware</span><span class="w"> </span><span class="nx">initialization</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">called</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Communication</span><span class="w"> </span><span class="nx">protocol</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">initialized</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">The</span><span class="w"> </span><span class="nx">main</span><span class="w"> </span><span class="nx">loop</span><span class="w"> </span><span class="nx">processes</span><span class="w"> </span><span class="nx">commands</span><span class="w"> </span><span class="nx">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Responses</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">sent</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="k">type</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">framework</span><span class="w"> </span><span class="k">like</span><span class="w"> </span><span class="nx">Catch2</span><span class="w"> </span><span class="k">or</span><span class="w"> </span><span class="nx">Google</span><span class="w"> </span><span class="nx">Test</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Ensure</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">development</span><span class="w"> </span><span class="nx">PC</span><span class="w"> </span><span class="p">(</span><span class="k">not</span><span class="w"> </span><span class="nx">requiring</span><span class="w"> </span><span class="nx">actual</span><span class="w"> </span><span class="nx">hardware</span><span class="p">)</span>
</code></pre></div>

<h3>2.2 Hardware Abstraction Layer</h3>
<p><strong>Description:</strong>
We need to create a hardware abstraction layer for the STM32H573I-DK. This will provide a clean interface for initializing hardware, using hardware acceleration, managing power, and configuring memory protection.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">abstraction</span><span class="w"> </span><span class="nx">layer</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H573I</span><span class="o">-</span><span class="nx">DK</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span><span class="nx">cpp</span><span class="o">/</span><span class="nx">embedded</span><span class="o">/</span><span class="nx">hardware_init</span><span class="p">.</span><span class="nx">h</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">defines</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Hardware</span><span class="w"> </span><span class="nx">initialization</span><span class="w"> </span><span class="nx">functions</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Hardware</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="p">(</span><span class="nx">AES</span><span class="o">-</span><span class="nx">GCM</span><span class="p">,</span><span class="w"> </span><span class="nx">SHA</span><span class="p">,</span><span class="w"> </span><span class="nx">RNG</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Power</span><span class="w"> </span><span class="nx">management</span><span class="w"> </span><span class="nx">functions</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Memory</span><span class="w"> </span><span class="nx">protection</span><span class="w"> </span><span class="nx">configuration</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Secure</span><span class="w"> </span><span class="nx">boot</span><span class="w"> </span><span class="nx">verification</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span><span class="nx">cpp</span><span class="o">/</span><span class="nx">embedded</span><span class="o">/</span><span class="nx">hardware_init</span><span class="p">.</span><span class="nx">cpp</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">implements</span><span class="w"> </span><span class="nx">these</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H5</span><span class="w"> </span><span class="nx">HAL</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Focus</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">AES</span><span class="o">-</span><span class="nx">GCM</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="p">,</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">critical</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">encryption</span><span class="w"> </span><span class="nx">service</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">protection</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">isolate</span><span class="w"> </span><span class="nx">sensitive</span><span class="w"> </span><span class="nx">operations</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Include</span><span class="w"> </span><span class="nx">proper</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="nx">reporting</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">abstraction</span><span class="w"> </span><span class="nx">layer</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">unit</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">major</span><span class="w"> </span><span class="nx">component</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Hardware</span><span class="w"> </span><span class="nx">initialization</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">AES</span><span class="o">-</span><span class="nx">GCM</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">SHA</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Random</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">generation</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Memory</span><span class="w"> </span><span class="nx">protection</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Use</span><span class="w"> </span><span class="nx">mock</span><span class="w"> </span><span class="nx">implementations</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H5</span><span class="w"> </span><span class="nx">HAL</span><span class="w"> </span><span class="nx">functions</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">calls</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">appropriate</span><span class="w"> </span><span class="nx">HAL</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">correct</span><span class="w"> </span><span class="nx">parameters</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Test</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">simulating</span><span class="w"> </span><span class="nx">HAL</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">failures</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Ensure</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="nx">can</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">development</span><span class="w"> </span><span class="nx">PC</span>
</code></pre></div>

<h3>2.3 Memory Protection Configuration</h3>
<p><strong>Description:</strong>
We need to implement memory protection for the STM32H573I-DK to isolate sensitive operations and protect against attacks. This will use the Memory Protection Unit (MPU) to define secure regions.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">implement</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">protection</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H573I</span><span class="o">-</span><span class="nx">DK</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">MPU</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">function</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">configure</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">MPU</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">secure</span><span class="w"> </span><span class="nx">regions</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Cryptographic</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">sensitive</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">(</span><span class="nx">read</span><span class="o">/</span><span class="nx">write</span><span class="w"> </span><span class="nx">only</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">privileged</span><span class="w"> </span><span class="nx">code</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Code</span><span class="w"> </span><span class="nx">execution</span><span class="w"> </span><span class="nx">regions</span><span class="w"> </span><span class="p">(</span><span class="nx">execute</span><span class="o">-</span><span class="nx">only</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Peripheral</span><span class="w"> </span><span class="nx">regions</span><span class="w"> </span><span class="p">(</span><span class="nx">privileged</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">only</span><span class="p">)</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">proper</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">documentation</span><span class="w"> </span><span class="nx">explaining</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">benefits</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">each</span><span class="w"> </span><span class="nx">configuration</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Ensure</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">configuration</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">applied</span><span class="w"> </span><span class="nx">early</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">boot</span><span class="w"> </span><span class="nx">process</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">protection</span><span class="w"> </span><span class="n">configuration</span><span class="p">.</span><span class="w"> </span><span class="nl">Please:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="nl">verifies:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">MPU</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">disabled</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="n">configuration</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Correct</span><span class="w"> </span><span class="n">regions</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">configured</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">appropriate</span><span class="w"> </span><span class="n">permissions</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">MPU</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="n">enabled</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">configuration</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">MPU</span><span class="w"> </span><span class="n">configuration</span><span class="w"> </span><span class="n">functions</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">parameters</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">passed</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">HAL</span><span class="w"> </span><span class="n">functions</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">simulating</span><span class="w"> </span><span class="n">HAL</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">failures</span>
</code></pre></div>

<h2>Phase 3: Communication Protocol</h2>
<h3>3.1 Communication Protocol Definition</h3>
<p><strong>Description:</strong>
We need to define a communication protocol between the PC and the STM32H573I-DK. This protocol will handle command and response messages for encryption operations.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">define</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">embedded</span><span class="o">/</span><span class="n">comm_protocol</span><span class="o">.</span><span class="n">h</span><span class="w"> </span><span class="n">that</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Defines</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="p">(</span><span class="n">Encrypt</span><span class="p">,</span><span class="w"> </span><span class="n">Decrypt</span><span class="p">,</span><span class="w"> </span><span class="n">KeyGen</span><span class="p">,</span><span class="w"> </span><span class="n">Status</span><span class="p">,</span><span class="w"> </span><span class="n">Reset</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Defines</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">codes</span><span class="w"> </span><span class="p">(</span><span class="n">Success</span><span class="p">,</span><span class="w"> </span><span class="n">InvalidCommand</span><span class="p">,</span><span class="w"> </span><span class="n">AuthenticationFailed</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Defines</span><span class="w"> </span><span class="n">structures</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">responses</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Creates</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Protocol</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Initializing</span><span class="w"> </span><span class="n">communication</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Checking</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">commands</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Receiving</span><span class="w"> </span><span class="n">commands</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Sending</span><span class="w"> </span><span class="n">responses</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Sending</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">responses</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Includes</span><span class="w"> </span><span class="n">constants</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="p">(</span><span class="n">magic</span><span class="w"> </span><span class="n">numbers</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">codes</span><span class="p">,</span><span class="w"> </span><span class="n">etc</span><span class="o">.</span><span class="p">)</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code>I need to test our communication protocol definition. Please:
1. Create unit tests that verify:
   - Command and response structures have the expected layout
   - Protocol class methods have the correct signatures
   - Constants have the expected values
2. These should be compile-time tests that ensure the protocol definition is correct
3. No runtime functionality needs to be tested at this stage
</code></pre></div>

<h3>3.2 Communication Protocol Implementation</h3>
<p><strong>Description:</strong>
We need to implement the communication protocol for the STM32H573I-DK. This will handle UART communication, message formatting, and error handling.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">implement</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">embedded</span><span class="o">/</span><span class="n">comm_protocol</span><span class="o">.</span><span class="n">cpp</span><span class="w"> </span><span class="n">that</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Implements</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Protocol</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">defined</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">comm_protocol</span><span class="o">.</span><span class="n">h</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Uses</span><span class="w"> </span><span class="n">UART</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="p">(</span><span class="n">USART1</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span><span class="p">)</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Handles</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">formatting</span><span class="w"> </span><span class="n">according</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">protocol</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">magic</span><span class="w"> </span><span class="n">number</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">byte</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">type</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">length</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">ID</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Variable</span><span class="o">-</span><span class="n">length</span><span class="w"> </span><span class="n">payload</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="n">CRC</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Implements</span><span class="w"> </span><span class="n">proper</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">timeout</span><span class="w"> </span><span class="n">management</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Includes</span><span class="w"> </span><span class="n">CRC</span><span class="w"> </span><span class="n">calculation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">validation</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">implementation</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Protocol</span><span class="w"> </span><span class="n">initialization</span><span class="w"> </span><span class="n">configures</span><span class="w"> </span><span class="n">UART</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="n">reception</span><span class="w"> </span><span class="n">parses</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Response</span><span class="w"> </span><span class="n">sending</span><span class="w"> </span><span class="n">formats</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">CRC</span><span class="w"> </span><span class="n">calculation</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">expected</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">failure</span><span class="w"> </span><span class="n">scenarios</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UART</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">simulate</span><span class="w"> </span><span class="n">communication</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="n">types</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">payloads</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">malformed</span><span class="w"> </span><span class="n">messages</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">rejected</span>
</code></pre></div>

<h3>3.3 Command Handlers</h3>
<p><strong>Description:</strong>
We need to implement handlers for the various commands supported by our protocol. These will process encryption, decryption, and key generation commands.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">implement</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="nx">handlers</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">communication</span><span class="w"> </span><span class="nx">protocol</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span><span class="nx">cpp</span><span class="o">/</span><span class="nx">embedded</span><span class="o">/</span><span class="nx">command_handlers</span><span class="p">.</span><span class="nx">h</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">command_handlers</span><span class="p">.</span><span class="nx">cpp</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">handlers</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Encrypt</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="p">(</span><span class="nx">processEncryptCommand</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Decrypt</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="p">(</span><span class="nx">processDecryptCommand</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Key</span><span class="w"> </span><span class="nx">generation</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="p">(</span><span class="nx">processKeyGenCommand</span><span class="p">)</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Each</span><span class="w"> </span><span class="nx">handler</span><span class="w"> </span><span class="nx">should</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Validate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">command</span><span class="w"> </span><span class="nx">data</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Extract</span><span class="w"> </span><span class="nx">parameters</span><span class="w"> </span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">etc</span><span class="p">.)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Perform</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">requested</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">encryptor</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Format</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">send</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">response</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Handle</span><span class="w"> </span><span class="nx">errors</span><span class="w"> </span><span class="nx">appropriately</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Include</span><span class="w"> </span><span class="nx">proper</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="nx">reporting</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">handlers</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Each</span><span class="w"> </span><span class="n">handler</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">validates</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">data</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Parameters</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">extracted</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Operations</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">performed</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">parameters</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Responses</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Errors</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">handled</span><span class="w"> </span><span class="n">appropriately</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">encryptor</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">protocol</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">isolate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">handlers</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">conditions</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">malformed</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">rejected</span>
</code></pre></div>

<h2>Phase 4: Hardware Acceleration</h2>
<h3>4.1 Rust Crypto Library Adaptation</h3>
<p><strong>Description:</strong>
We need to adapt our Rust crypto library to support hardware acceleration on the STM32H573I-DK. This involves adding conditional compilation for embedded targets and FFI functions for hardware acceleration.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">adapt</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">support</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">on</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H573I</span><span class="o">-</span><span class="nx">DK</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">modify</span><span class="w"> </span><span class="nx">rust</span><span class="o">/</span><span class="nx">crypto</span><span class="o">/</span><span class="nx">src</span><span class="o">/</span><span class="nx">lib</span><span class="p">.</span><span class="nx">rs</span><span class="w"> </span><span class="nx">to</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Add</span><span class="w"> </span><span class="nx">conditional</span><span class="w"> </span><span class="nx">compilation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">embedded</span><span class="w"> </span><span class="nx">targets</span><span class="w"> </span><span class="p">(</span><span class="err">#</span><span class="p">[</span><span class="nx">cfg</span><span class="p">(</span><span class="nx">feature</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&quot;embedded&quot;</span><span class="p">)])</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Define</span><span class="w"> </span><span class="nx">FFI</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">hw_aes_gcm_encrypt</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">hw_aes_gcm_decrypt</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">hw_random_bytes</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">available</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">encrypt_with_hardware</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">decrypt_with_hardware</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">get_random_bytes</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Modify</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">existing</span><span class="w"> </span><span class="nx">encrypt_data</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">decrypt_data</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="nx">to</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Try</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">first</span><span class="w"> </span><span class="p">(</span><span class="nx">when</span><span class="w"> </span><span class="nx">available</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Fall</span><span class="w"> </span><span class="nx">back</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">software</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">fails</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Ensure</span><span class="w"> </span><span class="nx">proper</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="nx">reporting</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">Rust</span><span class="w"> </span><span class="nx">crypto</span><span class="w"> </span><span class="kn">library</span><span class="w"> </span><span class="nx">adaptation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Create</span><span class="w"> </span><span class="nx">unit</span><span class="w"> </span><span class="nx">tests</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Conditional</span><span class="w"> </span><span class="nx">compilation</span><span class="w"> </span><span class="nx">works</span><span class="w"> </span><span class="nx">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">called</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">available</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Software</span><span class="w"> </span><span class="nx">fallback</span><span class="w"> </span><span class="nx">works</span><span class="w"> </span><span class="nx">when</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">fails</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="nx">works</span><span class="w"> </span><span class="nx">correctly</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Mock</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span><span class="w"> </span><span class="nx">functions</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Test</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">various</span><span class="w"> </span><span class="nx">input</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">conditions</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">consistent</span><span class="w"> </span><span class="nx">between</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">software</span><span class="w"> </span><span class="nx">implementations</span>
</code></pre></div>

<h3>4.2 C++ Hardware Acceleration Interface</h3>
<p><strong>Description:</strong>
We need to implement a C++ interface for the STM32H5's hardware cryptographic accelerators. This will provide functions for AES-GCM encryption/decryption and random number generation.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">implement</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">C</span><span class="o">++</span><span class="w"> </span><span class="kd">interface</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H5</span><span class="err">&#39;</span><span class="nx">s</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">cryptographic</span><span class="w"> </span><span class="nx">accelerators</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span><span class="nx">cpp</span><span class="o">/</span><span class="nx">embedded</span><span class="o">/</span><span class="nx">hw_crypto</span><span class="p">.</span><span class="nx">cpp</span><span class="w"> </span><span class="nx">that</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Implements</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">following</span><span class="w"> </span><span class="nx">C</span><span class="w"> </span><span class="nx">functions</span><span class="w"> </span><span class="p">(</span><span class="nx">to</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">called</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">Rust</span><span class="p">):</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">hw_aes_gcm_encrypt</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">hw_aes_gcm_decrypt</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">hw_random_bytes</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Uses</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">STM32H5</span><span class="w"> </span><span class="nx">HAL</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">access</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">accelerators</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">CRYP</span><span class="w"> </span><span class="nx">peripheral</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">AES</span><span class="o">-</span><span class="nx">GCM</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">RNG</span><span class="w"> </span><span class="nx">peripheral</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">random</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">generation</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Handles</span><span class="w"> </span><span class="nx">parameter</span><span class="w"> </span><span class="nx">validation</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">reporting</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Includes</span><span class="w"> </span><span class="nx">proper</span><span class="w"> </span><span class="nx">cleanup</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">resources</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Optimizes</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">performance</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.,</span><span class="w"> </span><span class="nx">using</span><span class="w"> </span><span class="nx">DMA</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="nx">appropriate</span><span class="p">)</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">C</span><span class="o">++</span><span class="w"> </span><span class="n">hardware</span><span class="w"> </span><span class="n">acceleration</span><span class="w"> </span><span class="n">interface</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Hardware</span><span class="w"> </span><span class="n">acceleration</span><span class="w"> </span><span class="n">functions</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">correct</span><span class="w"> </span><span class="n">HAL</span><span class="w"> </span><span class="n">functions</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Parameters</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">validated</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Resources</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">properly</span><span class="w"> </span><span class="n">cleaned</span><span class="w"> </span><span class="n">up</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H5</span><span class="w"> </span><span class="n">HAL</span><span class="w"> </span><span class="n">functions</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">input</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">conditions</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Rust</span><span class="w"> </span><span class="n">FFI</span>
</code></pre></div>

<h2>Phase 5: PC-Side Integration</h2>
<h3>5.1 PC-Side Communication Interface</h3>
<p><strong>Description:</strong>
We need to create a PC-side interface for communicating with the STM32H573I-DK. This will allow the PC application to send encryption requests to the embedded device.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">PC</span><span class="o">-</span><span class="n">side</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">communicating</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">STM32H573I</span><span class="o">-</span><span class="n">DK</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">embedded_device</span><span class="o">.</span><span class="n">h</span><span class="w"> </span><span class="n">that</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Defines</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">EmbeddedDevice</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Connecting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Disconnecting</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Checking</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">status</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encrypting</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Decrypting</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Generating</span><span class="w"> </span><span class="n">keys</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Getting</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">status</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Includes</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Sending</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Receiving</span><span class="w"> </span><span class="n">responses</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Handling</span><span class="w"> </span><span class="n">errors</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Defines</span><span class="w"> </span><span class="n">constants</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">IDs</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">codes</span><span class="w"> </span><span class="p">(</span><span class="n">matching</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">side</span><span class="p">)</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">PC</span><span class="o">-</span><span class="n">side</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">interface</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Connection</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">disconnection</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Commands</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">formatted</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Responses</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">parsed</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">simulate</span><span class="w"> </span><span class="n">communication</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">responses</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">interface</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">handles</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">errors</span>
</code></pre></div>

<h3>5.2 Serial Communication Implementation</h3>
<p><strong>Description:</strong>
We need to implement serial communication for the PC side to communicate with the STM32H573I-DK. This will provide a cross-platform way to send and receive data over a serial port.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">implement</span><span class="w"> </span><span class="nx">serial</span><span class="w"> </span><span class="nx">communication</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">PC</span><span class="w"> </span><span class="nx">side</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">src</span><span class="o">/</span><span class="nx">cpp</span><span class="o">/</span><span class="nx">core</span><span class="o">/</span><span class="nx">serial_port</span><span class="p">.</span><span class="nx">h</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">serial_port</span><span class="p">.</span><span class="nx">cpp</span><span class="w"> </span><span class="nx">that</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Define</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">SerialPort</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nx">with</span><span class="w"> </span><span class="nx">methods</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Opening</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">closing</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Checking</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">open</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Writing</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Reading</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Reading</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">specific</span><span class="w"> </span><span class="nx">number</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">bytes</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="nx">Flushing</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">port</span><span class="w"> </span><span class="nx">buffers</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">platform</span><span class="o">-</span><span class="nx">specific</span><span class="w"> </span><span class="nx">code</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">Windows</span><span class="p">,</span><span class="w"> </span><span class="nx">Linux</span><span class="p">,</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">macOS</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Handle</span><span class="w"> </span><span class="nx">timeouts</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">conditions</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Provide</span><span class="w"> </span><span class="nx">clear</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">reporting</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="n">communication</span><span class="w"> </span><span class="n">implementation</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Port</span><span class="w"> </span><span class="n">opening</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">closing</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">writing</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="n">reading</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Timeout</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">platform</span><span class="o">-</span><span class="n">specific</span><span class="w"> </span><span class="n">serial</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="n">functions</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">different</span><span class="w"> </span><span class="n">platforms</span><span class="w"> </span><span class="p">(</span><span class="n">Windows</span><span class="p">,</span><span class="w"> </span><span class="n">Linux</span><span class="p">,</span><span class="w"> </span><span class="n">macOS</span><span class="p">)</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">implementation</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">baud</span><span class="w"> </span><span class="n">rates</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">settings</span>
</code></pre></div>

<h3>5.3 Encryptor Modification for Embedded Device</h3>
<p><strong>Description:</strong>
We need to modify our Encryptor class to support using the embedded device for encryption operations. This will allow the PC application to offload encryption to the STM32H573I-DK.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">Encryptor</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">encryption</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="w"> </span><span class="n">update</span><span class="w"> </span><span class="n">src</span><span class="o">/</span><span class="n">cpp</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="n">encryptor</span><span class="o">.</span><span class="n">h</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">encryptor</span><span class="o">.</span><span class="n">cpp</span><span class="w"> </span><span class="n">to</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">EncryptionMode</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="p">(</span><span class="n">Local</span><span class="p">,</span><span class="w"> </span><span class="n">Embedded</span><span class="p">)</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">mode</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">port</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Getting</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">mode</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Checking</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">connected</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">private</span><span class="w"> </span><span class="n">members</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Current</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">mode</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">instance</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Modify</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">encrypt</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">decrypt</span><span class="w"> </span><span class="n">methods</span><span class="w"> </span><span class="n">to</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Embedded</span><span class="w"> </span><span class="n">mode</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Fall</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">fails</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Local</span><span class="w"> </span><span class="n">mode</span>
<span class="mf">5.</span><span class="w"> </span><span class="n">Include</span><span class="w"> </span><span class="n">proper</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">logging</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">Encryptor</span><span class="w"> </span><span class="n">modifications</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">support</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">retrieved</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="n">works</span><span class="w"> </span><span class="n">correctly</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Embedded</span><span class="w"> </span><span class="n">mode</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">falls</span><span class="w"> </span><span class="n">back</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">fails</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">uses</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">when</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">Local</span><span class="w"> </span><span class="n">mode</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Mock</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">simulate</span><span class="w"> </span><span class="n">communication</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">conditions</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">consistent</span><span class="w"> </span><span class="n">between</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">encryption</span>
</code></pre></div>

<h2>Phase 6: Testing &amp; Optimization</h2>
<h3>6.1 Integration Testing</h3>
<p><strong>Description:</strong>
We need to create integration tests to verify that the PC and embedded components work together correctly. These tests will ensure that encryption requests from the PC are properly processed by the STM32H573I-DK.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">integration</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">components</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">verify</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">connect</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">embedded</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">send</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">requests</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Device</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">processes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">requests</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">PC</span><span class="w"> </span><span class="n">correctly</span><span class="w"> </span><span class="n">receives</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">processes</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">responses</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Include</span><span class="w"> </span><span class="n">tests</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sizes</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">types</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">conditions</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">recovery</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">results</span><span class="w"> </span><span class="k">match</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">expected</span><span class="w"> </span><span class="n">output</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nv">I</span><span class="w"> </span><span class="nv">need</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">run</span><span class="w"> </span><span class="nv">integration</span><span class="w"> </span><span class="nv">tests</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">our</span><span class="w"> </span><span class="nv">PC</span><span class="w"> </span><span class="nv">and</span><span class="w"> </span><span class="nv">embedded</span><span class="w"> </span><span class="nv">components</span>.<span class="w"> </span><span class="nv">Please</span>:
<span class="mi">1</span>.<span class="w"> </span><span class="k">Connect</span><span class="w"> </span><span class="nv">an</span><span class="w"> </span><span class="nv">STM32H573I</span><span class="o">-</span><span class="nv">DK</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">development</span><span class="w"> </span><span class="nv">PC</span>
<span class="mi">2</span>.<span class="w"> </span><span class="nv">Flash</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">embedded</span><span class="w"> </span><span class="nv">firmware</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">device</span>
<span class="mi">3</span>.<span class="w"> </span><span class="nv">Run</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">integration</span><span class="w"> </span><span class="nv">tests</span>
<span class="mi">4</span>.<span class="w"> </span><span class="nv">Verify</span><span class="w"> </span><span class="nv">that</span><span class="w"> </span><span class="nv">all</span><span class="w"> </span><span class="nv">tests</span><span class="w"> </span><span class="nv">pass</span>
<span class="mi">5</span>.<span class="w"> </span><span class="nv">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nv">any</span><span class="w"> </span><span class="nv">performance</span><span class="w"> </span><span class="nv">issues</span><span class="w"> </span><span class="nv">or</span><span class="w"> </span><span class="nv">bottlenecks</span>
</code></pre></div>

<h3>6.2 Performance Optimization</h3>
<p><strong>Description:</strong>
We need to optimize the performance of our encryption service, focusing on throughput, latency, and power consumption. This will ensure that the STM32H573I-DK provides efficient encryption services.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">optimize</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">performance</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">encryption</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Profile</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">current</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">identify</span><span class="w"> </span><span class="nx">bottlenecks</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Optimize</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">communication</span><span class="w"> </span><span class="nx">protocol</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">efficiency</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Maximize</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">hardware</span><span class="w"> </span><span class="nx">acceleration</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">DMA</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="nx">transfer</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="nx">appropriate</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Optimize</span><span class="w"> </span><span class="nx">power</span><span class="w"> </span><span class="nx">consumption</span><span class="w"> </span><span class="nx">during</span><span class="w"> </span><span class="nx">idle</span><span class="w"> </span><span class="nx">periods</span>
<span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">Measure</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">report</span><span class="w"> </span><span class="nx">performance</span><span class="w"> </span><span class="nx">improvements</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="n">I</span><span class="w"> </span><span class="n">need</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">our</span><span class="w"> </span><span class="n">optimized</span><span class="w"> </span><span class="n">encryption</span><span class="w"> </span><span class="n">service</span><span class="o">.</span><span class="w"> </span><span class="n">Please</span><span class="p">:</span>
<span class="mf">1.</span><span class="w"> </span><span class="n">Create</span><span class="w"> </span><span class="n">benchmarks</span><span class="w"> </span><span class="k">for</span><span class="p">:</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">throughput</span><span class="w"> </span><span class="p">(</span><span class="n">bytes</span><span class="w"> </span><span class="n">per</span><span class="w"> </span><span class="n">second</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Encryption</span><span class="w"> </span><span class="n">latency</span><span class="w"> </span><span class="p">(</span><span class="n">time</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">encrypt</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">fixed</span><span class="o">-</span><span class="n">size</span><span class="w"> </span><span class="n">block</span><span class="p">)</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Power</span><span class="w"> </span><span class="n">consumption</span><span class="w"> </span><span class="n">during</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">idle</span><span class="w"> </span><span class="n">periods</span>
<span class="mf">2.</span><span class="w"> </span><span class="n">Compare</span><span class="w"> </span><span class="n">performance</span><span class="w"> </span><span class="n">before</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">after</span><span class="w"> </span><span class="n">optimization</span>
<span class="mf">3.</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">various</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">sizes</span><span class="w"> </span><span class="p">(</span><span class="n">small</span><span class="p">,</span><span class="w"> </span><span class="n">medium</span><span class="p">,</span><span class="w"> </span><span class="n">large</span><span class="p">)</span>
<span class="mf">4.</span><span class="w"> </span><span class="n">Verify</span><span class="w"> </span><span class="n">that</span><span class="w"> </span><span class="n">optimizations</span><span class="w"> </span><span class="n">don</span><span class="s1">&#39;t affect correctness</span>
</code></pre></div>

<h3>6.3 Security Validation</h3>
<p><strong>Description:</strong>
We need to validate the security of our encryption service, focusing on key management, side-channel protection, and secure communication. This will ensure that the STM32H573I-DK provides secure encryption services.</p>
<p><strong>Development Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code><span class="nx">I</span><span class="w"> </span><span class="nx">need</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">our</span><span class="w"> </span><span class="nx">encryption</span><span class="w"> </span><span class="nx">service</span><span class="p">.</span><span class="w"> </span><span class="nx">Please</span><span class="p">:</span>
<span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="nx">Review</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">implementation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">vulnerabilities</span>
<span class="mi">2</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">keys</span><span class="w"> </span><span class="nx">are</span><span class="w"> </span><span class="nx">properly</span><span class="w"> </span><span class="k">protected</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">memory</span>
<span class="mi">3</span><span class="p">.</span><span class="w"> </span><span class="nx">Check</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">side</span><span class="o">-</span><span class="nx">channel</span><span class="w"> </span><span class="nx">vulnerabilities</span>
<span class="mi">4</span><span class="p">.</span><span class="w"> </span><span class="nx">Ensure</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">communication</span><span class="w"> </span><span class="nx">protocol</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">secure</span>
<span class="mi">5</span><span class="p">.</span><span class="w"> </span><span class="nx">Verify</span><span class="w"> </span><span class="nx">that</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="nx">handling</span><span class="w"> </span><span class="nx">doesn</span><span class="err">&#39;</span><span class="nx">t</span><span class="w"> </span><span class="nx">leak</span><span class="w"> </span><span class="nx">sensitive</span><span class="w"> </span><span class="nx">information</span>
<span class="mi">6</span><span class="p">.</span><span class="w"> </span><span class="nx">Implement</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="nx">necessary</span><span class="w"> </span><span class="nx">security</span><span class="w"> </span><span class="nx">improvements</span>
</code></pre></div>

<p><strong>Unit Test Prompt:</strong></p>
<div class="codehilite"><pre><span></span><code>I need to test the security of our encryption service. Please:
1. Create security tests that verify:
   - Keys are not exposed in memory dumps
   - Side-channel attacks are mitigated
   - Communication is protected against replay and tampering
   - Error handling doesn&#39;t leak sensitive information
2. Attempt to exploit potential vulnerabilities
3. Verify that security measures are effective
</code></pre></div>

<h2>Conclusion</h2>
<p>This development guide provides a comprehensive approach to migrating CRUSTy-Core to the STM32H573I-DK microcontroller and implementing encryption services from the embedded system. By following this guide and using the provided prompts, you can develop each component of the system in a structured and testable way.</p>
<p>The key benefits of this approach include:</p>
<ol>
<li>
<p><strong>Maintains Architectural Integrity</strong>: Preserves the core design philosophy of using Rust for input handling and C++ for cryptographic operations.</p>
</li>
<li>
<p><strong>Hardware Acceleration</strong>: Leverages the STM32H5's hardware cryptographic accelerators for improved performance.</p>
</li>
<li>
<p><strong>Secure Communication</strong>: Implements a robust communication protocol between PC and embedded device.</p>
</li>
<li>
<p><strong>Fallback Mechanisms</strong>: Provides software fallbacks when hardware acceleration is unavailable.</p>
</li>
<li>
<p><strong>Comprehensive Testing</strong>: Includes unit tests for validating functionality and performance at each step.</p>
</li>
</ol>
<p>When you're ready to begin development, use the provided prompts to guide the implementation of each component.</p>
    </body>
    </html>
    